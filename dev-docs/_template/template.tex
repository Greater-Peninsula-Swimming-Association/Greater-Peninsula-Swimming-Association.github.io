\documentclass{article}

% Packages
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage[margin=1in]{geometry}
\usepackage{tocbibind}
\usepackage{enumitem}
\usepackage{sectsty}
\usepackage{xcolor}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{calc}
\usepackage{array}
\usepackage{tabularx}
\usepackage{setspace}
\usepackage{ragged2e}
% Load hyperref last (standard LaTeX best practice)
\usepackage{hyperref}

\providecommand{\tightlist}{}

% Prevent orphaned headings (headings at bottom of page with content on next page)
\usepackage{needspace}

% Widow and orphan penalties
\widowpenalty=10000
\clubpenalty=10000

% Hyphenation controls - reduce word splitting across lines
\hyphenpenalty=5000        % Penalty for hyphenating words (default: 50)
\exhyphenpenalty=5000      % Penalty for hyphenating after explicit hyphens
\tolerance=1000            % Flexibility for word spacing (default: 200, max: 10000)
\emergencystretch=3em      % Extra stretch to avoid overfull boxes
\setlength{\rightskip}{0pt plus 2em}  % Allow some flexibility on right margin

% Keep tables on same page - prevent page breaks within tables
\usepackage{float}

% Longtable spacing
\setlength{\LTpre}{2\baselineskip}    % Space before longtable
\setlength{\LTpost}{2\baselineskip}   % Space after longtable

% Prevent longtable breaks - simple and safe approach
% Process entire table in one chunk (max 10000 rows)
\setcounter{LTchunksize}{10000}

% Add penalties to discourage breaking (but allow if absolutely necessary)
\makeatletter
\patchcmd{\LT@array}
  {\par}
  {\par\penalty10000 }
  {}{}
\makeatother

% For regular tables
\AtBeginEnvironment{tabular}{\par\nopagebreak\vspace{\baselineskip}}
\AtEndEnvironment{tabular}{\par}

% Discourage page breaks after section headings
\usepackage{etoolbox}
\makeatletter
% Require at least 4 lines after a section heading before allowing a page break
\patchcmd{\section}{\@afterheading}{\@afterheading\needspace{4\baselineskip}}{}{}
\patchcmd{\subsection}{\@afterheading}{\@afterheading\needspace{3\baselineskip}}{}{}
\patchcmd{\subsubsection}{\@afterheading}{\@afterheading\needspace{2\baselineskip}}{}{}
\makeatother

% Font - Helvetica
\usepackage{helvet}
\renewcommand{\familydefault}{\sfdefault}

% Line spacing - 1.3
\setstretch{1.3}

\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=magenta,
    urlcolor=cyan,
}

% Header and Footer
\pagestyle{fancy}
\fancyhf{}
\lhead{Greater Peninsula Swimming Association (GPSA)}
\rhead{$title$}
$if(draft)$
\rfoot{DRAFT - $date$}
$else$
\rfoot{$date$}
$endif$
\cfoot{\thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

% Section formatting
\sectionfont{\Large\bfseries}
\subsectionfont{\large\bfseries}
\subsubsectionfont{\normalsize\bfseries}

$if(article_style)$
% Article-style numbering for constitution
\renewcommand{\thesection}{ARTICLE \Roman{section}}
% Adjust TOC spacing for longer section numbers
\usepackage{tocloft}
\setlength{\cftsecnumwidth}{6.5em}
\renewcommand{\cftsecaftersnum}{\hspace{0.5em}}
$endif$

% List formatting for 1.1.1 numbering scheme
% Section numbering: 1, 2, 3...
% Subsection numbering: 1.1, 1.2, 1.3...
% Enumerate list numbering (Pandoc controls this, attempts to customize were unsuccessful):
% Level 1: 1., 2., 3...
% Level 2: 1), 2), 3)...
% Level 3: 1., 2., 3...
% Level 4: a., b., c...

$if(title)$
\title{$title$$if(subtitle)$\\vspace{1.5em}{$subtitle$}$endif$}
$endif$
$if(author)$
\author{$for(author)$$author$$sep$ \and $endfor$}
$endif$
$if(date)$
\date{$date$}
$endif$

\begin{document}
\RaggedRight

$if(titlepage)$
\begin{titlepage}
    \newgeometry{margin=0.5in}
    \centering
    \vspace*{2cm}
    {\Huge \textbf{Greater Peninsula Swimming Association}}\\
    \vspace{1.5cm}
    $if(titlepage-logo)$
    \includegraphics[width=$if(logo-width)$$logo-width$$else$80mm$endif$]{$titlepage-logo$}\\
    $endif$
    \vspace{1.5cm}
    {\Huge \textbf{$title$}}\\
    $if(subtitle)$
    \vspace{1.5em}
    {\large \textbf{$subtitle$}}\\
    $endif$
    \vfill
    $if(author)$
    {\large $for(author)$$author$$sep$, $endfor$}\\
    \vspace{1em}
    $endif$
    $if(date)$
    {\large $date$}\\
    $endif$
\end{titlepage}
\restoregeometry
$else$
\maketitle
$endif$


$if(toc)$
\tableofcontents
\newpage
$endif$

$body$

\end{document}